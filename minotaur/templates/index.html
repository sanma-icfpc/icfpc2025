{% extends "base.html" %}
{% block content %}
<div>
  <!-- Tabs -->
  <div class="mb-4 border-b">
    <nav class="flex gap-2 -mb-px" role="tablist" aria-label="Tabs">
      <button id="tabbtn-main" onclick="switchTab('main')" class="px-3 py-2 border-b-2 border-blue-600 text-blue-600">Main</button>
      <button id="tabbtn-analytics" onclick="switchTab('analytics')" class="px-3 py-2 border-b-2 border-transparent text-gray-600 hover:text-gray-800">Analytics</button>
    </nav>
  </div>

  <!-- Main Tab -->
  <div id="tab-main">
    <h2 class="font-semibold mb-2">Scheduler</h2>
    <div id="priority-pane" class="mb-4">Loading priorities…</div>

    <h2 class="font-semibold mb-2">Challenges</h2>
    <div id="status">Loading...</div>
    <!-- content will be injected by loadStatus() via SSE or initial load -->
  </div>

  <!-- Analytics Tab -->
  <div id="tab-analytics" class="hidden">
    <div id="analytics-pane">Loading analytics…</div>
  </div>
</div>

<script>
  let analyticsLoaded = false;
  function switchTab(name) {
    const mainBtn = document.getElementById('tabbtn-main');
    const anaBtn = document.getElementById('tabbtn-analytics');
    const main = document.getElementById('tab-main');
    const ana = document.getElementById('tab-analytics');
    if (name === 'analytics') {
      main.classList.add('hidden');
      ana.classList.remove('hidden');
      mainBtn.className = 'px-3 py-2 border-b-2 border-transparent text-gray-600 hover:text-gray-800';
      anaBtn.className = 'px-3 py-2 border-b-2 border-blue-600 text-blue-600';
      if (!analyticsLoaded) loadAnalytics();
    } else {
      ana.classList.add('hidden');
      main.classList.remove('hidden');
      anaBtn.className = 'px-3 py-2 border-b-2 border-transparent text-gray-600 hover:text-gray-800';
      mainBtn.className = 'px-3 py-2 border-b-2 border-blue-600 text-blue-600';
    }
  }
  function loadAnalytics() {
    fetch('/minotaur/analytics', { credentials: 'same-origin' })
      .then(r => r.text())
      .then(html => {
        const el = document.getElementById('analytics-pane');
        el.innerHTML = html;
        analyticsLoaded = true;
      })
      .catch(() => {});
  }
  // Ensure Main is default active
  document.addEventListener('DOMContentLoaded', function() { switchTab('main'); });
</script>
{% endblock %}
